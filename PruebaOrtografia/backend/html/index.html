<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Prueba Ortografia</title>
    <link rel="stylesheet" href="css/style.css" title="min-width:640px">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="shortcut icon" href="imgs/favicon.jpg" />
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="containerprincipal" id="containerprincipal" name="palabras">
      <center>
        Prueba de Ortografía
        <div class="row">
          <div class="col-md-12" id="puntuacion">
            <p>Puntuación: 0/0</p>
          </div>
        </div>
        </div>
        <center>
        <div class="siguiente">
          <input type="button" id="siguiente" value="Siguiente">
        </div>
    <script type="text/javascript">
      var palabrasServidor = [];

      iniciarOrtografia();

      function iniciarOrtografia()
      {
        // palabrasServidor = recuperarPalabrasDelServidor();
        palabras = recuperarPalabras();

        console.log(palabras);
        iniciarDivs(palabras);
        rellenarDivs(palabras);
        escucharClicks();
        escucharClicksButtons();
      }


      function recuperarPalabras()
      {
        if (palabrasServidor.length == 0) {
         palabrasServidor = recuperarPalabrasDelServidor();

       }else {
         palabrasServidor.shift();
         palabrasServidor.shift();
         palabrasServidor.shift();
       }

        return palabrasServidor;
      }

      function recuperarPalabrasDelServidor()
      {
        var resultado = $.ajax({
          url: "ajax.php",
          async: false
        }).responseText;

        var array = JSON.parse(resultado);
        console.log(array);

        return array.palabras;
      }

      function escucharClicksButtons()
      {
        //lee los click de los input button y llama a las funciones necesarias para comprobar si la respuesta es correcta o no
        $('input').on("click", function(ev){
          correctQuestion(ev);
          incorrectQuestion(ev);
        });
      }

      function escucharClicks()
      {
          //lee el clcik del boton siguiente y llama a las funciones necesarias paracrear los nuevos divs
          $('#siguiente').on("click", function(){
            borrarDivs();

            var palabras = recuperarPalabras();

            iniciarDivs(palabras);
            rellenarDivs(palabras);
            escucharClicksButtons();
            finalizarPrueba();
            window.scrollTo(0, 0);
            console.log(palabras)
          });
      }

      var longitud = 3;

      function longitudDivs(palabras)
      {
        if (palabras.length >3) {
          var longitud = 3;
        }else{
          var longitud = palabras.length;
        }

        return longitud;
      }

      function rellenarDivs(palabras)
      {
        //escribe todas las palabras en el div indicado
        var longitud = longitudDivs(palabras);


        for (var i = 0; i <longitud; i++) {
          var palabra = palabras[i];

          $('#palabra'+ i).append(palabra["palabra"]);
        }
      }

//crea los divs necesarios para las palabras que haya en el aray
      function iniciarDivs(palabras){
        var longitud = longitudDivs(palabras);
        for (i=0;i<longitud;i++) {
          var palabra = palabras[i];
          var col = jQuery('<div/>', {
            class:'contenedor',
            id:'contenedor',
          });

          var col1 = jQuery('<div/>', {
            class:'row',
          });

          var col2 = jQuery('<div/>', {
            class:'col-md-12',
            id:'palabra'+ i,
          });

          var col3 = jQuery('<div/>', {
            class:'row',
            data:'cont'+i,
          });

          var col4 = jQuery('<div/>', {
            class:'col-md-6',
          });

          var col6 = jQuery('<div/>', {
            class:'col-md-6',
          });

          var col7 = jQuery('<input>', {
            type:'button',
            id:'correcto'+i,
            class: 'resultado'+palabra["resultado"],
            value:'Correcto',
          });

          var col8 = jQuery('<input>', {
            type:'button',
            id:'incorrecto'+i,
            class: 'resultado'+palabra["resultado"],
            value:'Incorrecto',
          });

          var col9 = jQuery('<center>', {
          });

          $(col).append(col9);
          $(col9).append(col1);
          $(col1).append(col2);
          $(col9).append(col3);
          $(col3).append(col4);
          $(col3).append(col6);
          $(col4).append(col7);
          $(col6).append(col8);

          $("#containerprincipal").append(col);
      }
    }
      var num=0;
//suma de uno en uno y es llamada cunado se acierta na palabra para asi mostrar la puntuacion
      function sumar() {
        num++;
        $('p').text('Puntuación: '+ num + '/' + clicks);
        }

        var clicks=0;
  //suma de uno en uno y es llamada cunado se acierta na palabra para asi mostrar la puntuacion
        function sumarclicks() {
          clicks++;
          $('p').text('Puntuación: '+ num + '/' + clicks);
          }

        function pintar(ev){
          $(ev.currentTarget)[0].disabled = true;
          $(ev.currentTarget)[0].style.color='#fff';
        }
//pinta los botones pulsados correctamente de verde
      function pintarCorrecto(ev)
        {
          pintar(ev);
          $(ev.currentTarget)[0].style.background='#71bf44';
        }
//pinta los botones pulsados incorrectamente de rojo
      function pintarIncorrecto(ev)
        {
          pintar(ev);
          $(ev.currentTarget)[0].style.background='#d85c5c';
        }


//comprueba si la palabra esta bien contestada
      function correctQuestion(ev){
//si el resultado es 1 y pulso el boton correcto pinto el boto de verde lo desactivo  pinto la letra de blanco, llamo a la funcion sumar que suma la puntuacion y llamoa a la funcion selectcorrect.
        if (($(ev.currentTarget)[0].className) == "resultado1" && ($(ev.currentTarget)[0].defaultValue) == "Correcto"){
              pintarCorrecto(ev);
              sumar();
              sumarclicks();
              selectcorrect(ev, $(ev.currentTarget)[0].id);
        }
//si el resultado es 2 y pulso el boton incorrecto pinto el boto de verde lo desactivo  pinto la letra de blanco, llamo a la funcion sumar que suma la puntuacion y llamo a la funcion selectcorrect.
        if (($(ev.currentTarget)[0].className) == "resultado2" && ($(ev.currentTarget)[0].defaultValue) == "Incorrecto"){
              pintarCorrecto(ev);
              sumar();
              sumarclicks();
              selectincorrect2(ev, $(ev.currentTarget)[0].id);
        }
      }
//comprueba si la plabra esta mal contestada
      function incorrectQuestion(ev){
//si el resultado es 1 y pulso el boton incorrecto pinto el boto de rojo lo desactivo  pinto la letra de blanco, llamo a la funcion selectincorrect.
        if (($(ev.currentTarget)[0].className) == "resultado1" && ($(ev.currentTarget)[0].defaultValue) == "Incorrecto"){
              pintarIncorrecto(ev);
              sumarclicks();
              selectincorrect(ev, $(ev.currentTarget)[0].id);
        }
//si el resultado es 2 y pulso el boton correcto pinto el boto de rojo lo desactivo  pinto la letra de blanco, llamo a la funcion selectincorrect.
        if (($(ev.currentTarget)[0].className) == "resultado2" && ($(ev.currentTarget)[0].defaultValue) == "Correcto"){
              pintarIncorrecto(ev);
              sumarclicks();
              selectcorrect2(ev, $(ev.currentTarget)[0].id);
        }
      }
      function selectcorrect(ev, idElementToDisable){
        var id = idElementToDisable.replace('correcto','');
//si pulso el boton correcto+i desactivo el boton incorrecto+i, si elresultado es 1 pinto el boton incorrecto+i de rojo  la letra de blanco
        if (($(ev.currentTarget)[0].id)== "correcto"+id) {
          $("#incorrecto"+id).attr("disabled", true);
          if (($(ev.currentTarget)[0].className) == "resultado1") {
            $('#incorrecto'+id).css('background-color', '#d85c5c');
            $('#incorrecto'+id).css('color', '#fff');
          }
          }
      }
      function selectincorrect(ev, idElementToDisable){
        var i = idElementToDisable.replace('incorrecto','');
//si pulso el boton incorrecto+i desactivo el boton correcto+i, si elresultado es 1 pinto el boton correcto+i de verde la letra de blanco
        if (($(ev.currentTarget)[0].id)== "incorrecto"+i) {
          $("#correcto"+i).attr("disabled", true);
          if (($(ev.currentTarget)[0].className) == "resultado1") {
            $('#correcto'+i).css('background-color', '#71bf44');
            $('#correcto'+i).css('color', '#fff');
          }
          }
      }
      function selectcorrect2(ev, idElementToDisable){
        var i = idElementToDisable.replace('correcto','');
//si pulso el boton correcto+i desactivoel boton incorrecto+i ,si el resultado es 2 pinto el boton incorrecto +1 de verde la letra de blanco
        if (($(ev.currentTarget)[0].id)== "correcto"+i) {
          $("#incorrecto"+i).attr("disabled", true);
          if (($(ev.currentTarget)[0].className) == "resultado2") {
            $('#incorrecto'+i).css('background-color', '#71bf44');
            $('#incorrecto'+i).css('color', '#fff');
          }
          }
      }
      function selectincorrect2(ev, idElementToDisable){
        var id = idElementToDisable.replace('incorrecto','');
//si pulso el boton incorrecto+i desactivo el boton correcto+i ,si el resultado es 2 pinto el boton correcto +1 de rojo la letra de blanco
        if (($(ev.currentTarget)[0].id)== "incorrecto"+id) {
          $("#correcto"+id).attr("disabled", true);
          if (($(ev.currentTarget)[0].className) == "resultado2") {
            $('#correcto'+id).css('background-color', '#d85c5c');
            $('#correcto'+id).css('color', '#fff');
          }
          }
      }
//borra los divs que contienen las palabras y los botones
      function borrarDivs(palabras){
        $('.contenedor').remove();
      }

      function finalizarPrueba()
      {
        if (palabras.length == 0) {
          $('.siguiente').remove();
          alert("Has acabado!!");
        }
      }

    </script>
  </body>
</html>
